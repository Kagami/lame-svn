<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.7 [en] (X11; I; Linux 2.2.12-20 i686) [Netscape]">
</head>
<body>

<center>
<h2>
Quality and Listening Test Information</h2></center>

<hr WIDTH="100%">
<h3>
Tuning by listening tests:</h3>

<ul>
<li>
Most improvements in GPSYCHO require detailed listening tests.&nbsp; The
best way to go about this is to find a sample where GPSYCHO does something
bad.&nbsp; Then see if you can figure out which algorithm/tuning is at
fault, and how it can be improved without breaking something else!</li>

<li>
MPEG likes the&nbsp; "ABC hidden reference test".&nbsp; Signal A is always
the original .wav file.&nbsp; B and C are the encoded and the original
signal, in a random order.&nbsp; Listen to ABC three times, always in that
order, and rate B and C on a scale from 1-5, 5 being for the signal you
perceive as the original.</li>
</ul>
<a href="preecho.html">Tuning by reverse engineering:</a>&nbsp;&nbsp; Here
is a detailed example on how the pre-echo algorithm in LAME 3.10 was tuned
and dramatically improved by doing a frame by frame comparison with the
FhG encoder.&nbsp;&nbsp; First a sample is found where LAME produces noticeably
worse results than the state-of-the-art FhG encoder.&nbsp; Listening tests
are used to determine which frames are causing most of the problems.&nbsp;
MP3x ( the frame analyzer) is then used to compare the troublesome frames
produced by LAME to those produced by the FhG encoder.&nbsp; In the case
presented, the problem was because LAME was not switching to short blocks
when it should have.
<center>
<h2>

<hr WIDTH="100%"></h2></center>

<center>
<h2>
Some Test Samples</h2></center>

<hr WIDTH="100%">
<p>Check out <a href="http://sound.media.mit.edu/mpeg4/audio/sqam">SQAM
- Sound Quality Assessment Material.</a>&nbsp; I haven't had a chance to
try these yet,
<br>but if you find samples where another encoder does noticeably better
than LAME,&nbsp; I would be very interested.
<br>&nbsp;
<br>&nbsp;
<center>
<h1>
Test cases which need work</h1></center>

<h3>
<a href="../download/samples">vbrtest.wav</a>&nbsp; "God loves his children"
with Lou Reid and Carolina.&nbsp; This sample fools some VBR modes.&nbsp;&nbsp;
(.8M&nbsp; 5 seconds)</h3>
VBR algorithms based on psycho acoustics (rather than perceptual entropy)
have trouble with this sample.&nbsp;&nbsp;&nbsp; VBR modes encode this
sample at about 20kbs less then average.&nbsp; But&nbsp; this is not a
case were VBR is getting the same quality at a lower bitrate!&nbsp;&nbsp;
From Ove (http://home.bip.net/ove.rung) :&nbsp;&nbsp; "Back in "the old
days" I was using tompg.exe for my encoding&nbsp; until I discovered a
really hard-to-encode tune.&nbsp; I still use that tune for testing new
encoders, and [MP+]&nbsp; produces heavy artifacts.
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">hihat.wav</a> pre-echo from a hi-hat.&nbsp;&nbsp;
(.5M&nbsp; 3 seconds)</h3>
Zia Mazhar&nbsp; writes:&nbsp; "It's a simple sound of a hi-hat. I tried
with BladeEnc, Xing,
<br>GOGO-no-coda ver. 2.26, FhG [all versions], and of course, the latest
version of LAME. But none sounds like the original. FhG sounds best, though.
Other encoders add a amplified "hissing sound" to the file. You can see
the difference even in the *WinAmp eq-visualization* display. It seems
that the original frequency changes a lot.
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">youcantdothat.wav</a>&nbsp;&nbsp;&nbsp; (5M&nbsp;
26 seconds)</h3>

<p><br>From David J M Robinson &lt;DavidR at europe.com> .&nbsp; From vinyl
- the results aren't too impressive using any encoder
<br>at 128kbps. On the initial guitar riff, LAME does better than either
the old FhG routine in mp3 Prod Pro, or the fast routine available in Cool
Edit Pro. The others have more difficulty with the echo in the right channel.
BUT when the vocals come in, the other codecs create an undercurrent of
noise (which is bad enough) while LAME seems to blast almost white noise
along with the vocal track, which sounds much worse IMHO.
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">pipes.wav</a>&nbsp;&nbsp;&nbsp; (2.6M&nbsp;
15 seconds)</h3>
From magnus at alum.mit.edu.&nbsp; Bagpipes.&nbsp; It's mainly that the
pipes are "muted".&nbsp; There's a certain "crispness"
<br>to the original that is lost after encoding.&nbsp; I'm not exactly
sure how&nbsp; else to explain it.
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">goldc.wav</a>&nbsp; "The Ecstasy Of Gold"
by Ennio Morricone&nbsp; (10sec, very complex part!)</h3>
&nbsp;Daniel Wronski writes:&nbsp; The Encoders: lame 3.70; lame 3.81BETA;
FHG 3.1DEMO; SCMPX 1.51; (constant
<br>bitrate; 128kb/sec; highest possible quality;)&nbsp; Personal rating
(sound quality only):
<p>&nbsp;1st place: The original sample.
<p>&nbsp;2nd place: FHG MP3ENC 3.1 Demo (-qual 9)&nbsp; This is the one
and only encoder I found, which does not make any additional noise.&nbsp;
However the bells sound a little bit different. (not a LAME problem)
<p>3rd place: LAME 3.81 BETA (-h) (no real difference to v3.83)&nbsp; Best
quality! But there are some high frequency metallic vibrations. (at ~6kHz?)
<p>4th place: LAME 3.70 (-h)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; More high
frequency metallic vibrations. Sounds like low cost trumpets are used.
(resonance between the metal parts of the trumpets)&nbsp;&nbsp;&nbsp; These
vibrations even occur, if the trumpets are not playing.
<p>5th place: SCMPX 1.51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
This one even makes additional noise.
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">ftb_test.wav</a>&nbsp; Obvious differences
between FhG and LAME.&nbsp; (4.5M 26 seconds)</h3>
This is a great test case found by&nbsp; &lt;jodaman at cegt201.bradley.edu>
.&nbsp; It is a selection from Metallica's Fade To Black.&nbsp;&nbsp; At
128kbs, the difference between LAME and FhG (mp3enc 3.1) is clearly noticable.&nbsp;
There are problems with the vocal 's' sounds, and there is a slight tinny
underwater sound.&nbsp;&nbsp; The old FhG encoder l3enc also has the same
problems.
<ul>
<li>
<a href="http://cegt201.bradley.edu/~jodaman/dev/mp3">Joda's Space</a>&nbsp;
The originator of this ftb_test.wav, and a rare example of the right way
to test encoders!</li>
</ul>

<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">testsignal2.wav</a>&nbsp;&nbsp;&nbsp; Subtle
pre-echo test case.&nbsp; (700K, about 5 seconds)</h3>
This is a very nice pre-echo test case from&nbsp; Jan Rafaj &lt;rafaj at
cedric.vabo.cz>.&nbsp;&nbsp;&nbsp;&nbsp; It&nbsp; has some clear, isolated
drums.&nbsp; If your MP3 encoder does not switch to short blocks at the
precise moment, you will have very noticeable pre-echo.&nbsp; The pre-echo
actually sounds like a snare,&nbsp; but this snare is completely artificial
- there is no trace of it in the original .wav file!&nbsp;&nbsp; ISO based
encoders do very poorly, mostly because the short block switching is completely
broken in the psy model (even if it detects a pre-echo event, it will switch
to short blocks 1 granule too late).&nbsp;&nbsp; LAME 3.03 does noticeably
better, but it still uses the ISO pre-echo detection criterion, and misses
many of the pre-echo events.&nbsp; If you go into l3psy.c and set switch_pe
= 1000 (instead of 1800), LAME will do much better, maybe 90% as good as
FhG.
<p>FhG does great.&nbsp; They seem to have excellent pre-echo detection.&nbsp;
I would love to know what their algorithm is based on.
<p>Note&nbsp; 5/99: LAME 3.05 has a much improved pre-echo detection algorithm,
and fixes some of the above problems!
<br>Note&nbsp; 7/99: LAME 3.16 has a better pre-echo detection, and allocates
more bits from the reservoir.
<ul>
<li>
<a href="ftp://cedric.vabo.cz/pub/linux/testfiles/mp3encoders/">Jan Rafaj's
mp3 testcases</a></li>
</ul>

<h3>
<a href="../download/samples">testsignal4.wav</a>&nbsp;&nbsp;&nbsp; Subtle
distortion case.&nbsp; (800K, about 6 seconds)</h3>
Another difficult and subtle case from Jan Rafaj &lt;rafaj at cedric.vabo.cz>.&nbsp;&nbsp;
I believe this is by Enya.&nbsp; There is a slight trill as the volume
increases.&nbsp; I can barely here it, but the FhG encoder manages to avoid
it. Using mid/side masking thresholds seems to help a lot (-h in LAME 3.21
and higher).
<br>&nbsp;
<br>&nbsp;
<center>
<h1>
Test cases previously used to improve LAME</h1></center>

<h3>
<a href="../download/samples">castanets.wav</a>&nbsp;&nbsp; FhG pre-echo
reference sample (1.2M, about 7 seconds)</h3>

<p><br>The castanets should sound like a sharp, crisp clack.&nbsp; In the
ISO psy-model, they are smeared out into&nbsp; long, soft thwack like sounds.&nbsp;
GPSYCHO makes a dramatic improvement in this, which is detectable on any
sound system.&nbsp; This is due to correctly switching to short blocks
and encoding them with extra bits from the reservoir.&nbsp; The attacks
are very mono in nature, so jstereo also helps because it allows even more
bits for encoding the mid channel.&nbsp; The sample is very close to mono,
but if you really decimate the side it will results in noticeable artifacts.
<p>The FhG encoder does an even better job on this sample, mostly because
it detects some of the later castanets. They are muffled by other sounds
and GPSYCHO fails to recognize them as needing short blocks.&nbsp; Latter
on in the sample, the castanets come fast and furious, and even the FhG
encoder can not maintain enough bits in the bit reservoir.&nbsp; VBR would
be great in this situation. It is very easy to put into an encoder, but
I don't have a player to debug it with.
<p>Normally you have to perform listening tests to determine the quality
of an mp3 encoding.&nbsp;&nbsp; You can not generally&nbsp; say anything
about the quality by looking at the original and encoded pcm signal.&nbsp;
Pre-echo problems like in castanets.wav are an exception to this.&nbsp;
In a bad encoding, the sharp attack of the castanets will create noise
that is heard<b> before </b>the actual castanets.&nbsp; This flaw is very
visible in the encoded pcm signal,&nbsp; and is shown for several different
encoders in&nbsp; <a href="../screenshots/screenshots.html">Screenshots.</a>
<p>With the castents.wav file it's easy to try out new short block detection
schemes.&nbsp; You dont have to rely on listening tests since the pre-echo
is so easy to see in the output pcm data.&nbsp; Just modify the graphical
interface display the new criterion and then go through castanets.wav frame
by frame and see if it is triggered in the correct spots.&nbsp; For an
interesting comparison, run lame with -g (the graphical frame analyzer)
on MP3 files produced by other encoders to see how well they do.
<br>&nbsp;
<h3>
<a href="../download/samples">track7.wav</a>&nbsp;&nbsp; Jazz sample&nbsp;
(800K,&nbsp; 4 seconds)</h3>
Sent by Naoki SHIBATA,&nbsp; shibatch at geocities.co.jp, see <a href="http://www.geocities.co.jp/Technopolis/9674/lametest/index.html">lametest</a>
<br>Naoki can hear noise in the left channel, but only when using a good
pair of headphones.&nbsp; It goes away
<br>when joint stereo is not used.&nbsp; Comparing with FhG, it looks like
LAME is toggling back and forth between
<br>MS and regular stereo when it should not be.&nbsp; As of LAME 3.83:
noise is almost gone.
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">Fools.wav</a>&nbsp;&nbsp; Good range of effects&nbsp;
(5M, about 30 seconds)</h3>
I got this off an MP3 encoder comparison web site that later vanished.&nbsp;
It is a section from Lemon Tree by Fool's Garden.&nbsp; It was heavily
used to tune the LAME 3.12 <a href="ms_stereo.html">mid/side switch.</a>.&nbsp;
I use a mono, downsampled version for the current MPEG2 quality improvements.
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">main_theme.wav</a>&nbsp;&nbsp;&nbsp;&nbsp;
Strange artifact, mid/side stereo test.&nbsp;&nbsp; (1.7M, about 11 seconds)</h3>
This sample is from an old Pink Floyd song.&nbsp; It was found by Robert
Hegemann &lt;Robert.Hegemann at gmx.de>
<br>In the beginning, while the foreground pans from right to left there
is a slight twinkling sound.&nbsp; This goes away
<br>with -X, but the true cause and a better fix should be found.&nbsp;
(NOTE: 11/99&nbsp; This problem is much improved around lame3.50)
<p>It also contains a lot of distortion if mid/side stereo is used.&nbsp;
The new (lame3.12) mid/side switching algorithm solves this problem and
can detect that almost none of the frames should use mid/side stereo.&nbsp;
The FhG also does not use mid/side encoding for this sample.
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">mstest.wav</a>&nbsp;&nbsp; Mide/Side stereo
encoding test sample&nbsp; (700K, about 5 seconds)</h3>
A good jstereo test case sent to me by Scott Miller &lt;scgmille at indiana.edu>.&nbsp;&nbsp;
It contains some higher frequency modes which are isolated to the left
channel.&nbsp; LAME sounds fine in Stereo mode (-m s), but using any type
of mid/side stereo will spread these modes to the right channel.&nbsp;
Switching between stereo and ms_stereo will result in the annoying effect
of having them turn on and off in the right channel.&nbsp; The FhG encoder
avoids this problem by using very few&nbsp; mid/side stereo frames.&nbsp;
But the LAME mid/side stereo switching criterion can not detect that this
sample should not be encode with mid/side stereo, and produces too many
mid/side frames.&nbsp; Suggestions for a better switching criterion are
welcome!&nbsp; I've tried a few things, but anything that works is usually
too restrictive, i.e. it will turn off mid/side stereo for half the frames
in castanets.wav, but this sample should have all frames mid/side stereo.
<p>NOTE 6/99: This problem is fixed with new <a href="ms_stereo.html">mid/side
switch</a> added to LAME 3.12!
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">t1.wav</a>&nbsp;&nbsp; Dire Straights sample&nbsp;
(1.4M, about 9 seconds)</h3>
This case has some subtle pre-echos that were missed by older versions
of LAME, and it greatly confused the old LAME mid/side stereo switching
criterion.&nbsp; It was found by Nils Faerber &lt;Nils.Faerber at unix-ag.org>.&nbsp;&nbsp;
It was heavily used to tune the LAME 3.12 <a href="ms_stereo.html">mid/side
switch,</a> and for more fine tuning of the pre-echo detection algorithm
in LAME 3.15.&nbsp;&nbsp; Nils reports that with LAME 3.12, the quality
is now very close to the FhG encoder.
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<h3>
<a href="../download/samples">else3.wav&nbsp;</a>&nbsp;&nbsp; Bit allocation
tests.&nbsp; (1.0M, about 6 seconds)</h3>
A sample from Sarah Mclaughlan's "Elsewhere".&nbsp; I first checked out
an MP3 of this song from the Internet (a very high quality encoding).&nbsp;
Later I bought the CD and encoded it my self with&nbsp; an ISO based encoder,
and was surprised at the difference in quality.&nbsp; This is what motivated
me to start looking at the encoder source.
<p>This song contains a lot of very tonal piano music for which even the
ISO encoder usually does ok.&nbsp; But in certain situations it produces
very noticeable distortion in the piano notes.&nbsp; (Particularly in frames
50-70).&nbsp; GPSYCHO fixes this mostly due to the improved outer_loop
in the bit allocation subroutine.&nbsp; This sample also has some attacks
(drums) that are greatly improved with GPSYCHO.&nbsp; I cannot detect a
difference between GPSYCHO and FhG for this sample.
<br>&nbsp;
<center>
<h2>
Test Cases Where LAME beats FhG!</h2></center>

<h3>
<a href="../download/samples">KMFDM-Dogma.wav</a>&nbsp;&nbsp;&nbsp; (1.1M,
about 6 seconds.)</h3>
Found by Kevin Burtch &lt;kburtch at bellsouth.net>.
<br>&nbsp;
<h3>
<a href="../download/samples">iron.wav</a>&nbsp;&nbsp; (6.2M, 35 seconds)</h3>
Found by Jee J C" &lt;jeejc at hotmail.com> .&nbsp; A short sample from
the Cardigans.
<br>&nbsp;
<h3>
<a href="../download/samples">spahm.wav&nbsp;</a>&nbsp;&nbsp;&nbsp; (4.4M,
about 25 seconds.)&nbsp; Similar to fatboy.wav, but FhG does much worse
for some reason.</h3>
From &lt;spahm at hotmail.com>
<br>&nbsp;
<h3>
<a href="../download/samples">BlackBird.wav&nbsp;</a>&nbsp;&nbsp;&nbsp;
(1.1M, about 6 seconds)</h3>
From davel at caffeine.co.uk:&nbsp;&nbsp; The opening bars from the Beautiful
South track 'Blackbird on the Wire' - you will notice it has some very
sudden synthesized drums in it. I encoded this track using both Lame and
Frau, and found that Frau just couldn't handle the first drum hit (it even
had trouble with subsequent ones which are less apparent on this particular
example) and actually drops out for a fraction of a second before the drum
hit. I have tried many settings on both decoders and Lame seems to handle
it no matter what, whereas Frau always trips up, even with the highest
quality setting. Bitrate is immaterial.
<br>&nbsp;
<br>&nbsp;
<center>
<h2>
Other Test Cases</h2></center>

<h3>
<a href="../download/samples">60.wav</a>&nbsp;&nbsp; Simple two tone test
case usefull for debugging.&nbsp;&nbsp; (900K,&nbsp; 5 seconds)</h3>
Sent by Naoki SHIBATA,&nbsp; shibatch at geocities.co.jp, see <a href="http://www.geocities.co.jp/Technopolis/9674/lametest/index.html">lametest</a>
<br>&nbsp;
<h3>
<a href="../download/samples">fatboy.wav</a>&nbsp;&nbsp; All encoders have
trouble with this one.&nbsp; (900K,&nbsp; about 5 seconds.)</h3>
Found by Jake Hamby &lt;jehamby at anobject.com>
<br>&nbsp;
<h3>
<a href="../download/samples">applaud.wav</a>&nbsp;&nbsp; 1.4M, about 9
seconds.</h3>
This is a very difficult test sample because of the lack on tonality and
all the sharp attacks.&nbsp;&nbsp; All encoders produce results noticeably
different than the original, but the FhG encoder still has the edge.&nbsp;
The extra quality of the FhG encoder is not due to simple fixes like better
use of short blocks and the bit reservoir.&nbsp;&nbsp; They do switch to
ms_stereo, (and GPSYCHO does not), but forcing GPSYCHO into ms_stereo doesn't
improve things.
<p>Information on the applaud.wav test sample:
<ul>
<li>
<a href="http://geek.rcc.se/mp3encoder">Jan Peman's applaus test case and
results from many other encoders</a></li>
</ul>

</body>
</html>
