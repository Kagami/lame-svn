<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<head>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
	<meta name="keywords" content="mp3,encoder,lame,source,code">
	<meta name="GENERATOR" content="Roberto's Awesome Notepad">
	<title>LAME LAME Ain't an MP3 Encoder</title>
</head>
<BODY>

<CENTER><H1>A Free Audio Compression Format?</H1></CENTER>

<HR>
Related Links:

<UL>
	<LI><A HREF="http://www-ccrma.stanford.edu/~bosse">The MUS420 project</A></LI>
	<LI><A HREF="http://www.xiph.org">Ogg/Vorbis</A>: A new format from the creators of cdparanoia.</LI>
	<LI><A HREF="http://www.audiocoding.com">The FAAC project</A>: An open source AAC implementation</LI>
</UL>

<p>Based on what I've learned working with <A HREF="index.html">LAME</A> and <A 
HREF="gpsycho/gpsycho.html">GPSYCHO</A>, I believe it would not be too difficult to develop an 
independent audio codec of slightly better quality than LAME, (and thus comparable to the best 
commercial MP3 codecs). Yes, it wont be as good as AAC, but think of this: how many people would use 
a proprietary compression code which was slightly better than gzip?
</p>

<p>The following is an outline of such an audio codec. It is based on general published ideas which 
form the basis of several encoders (MP3, MPEG4-AAC, AT&amp;T PAC). It includes most of the ideas that
were used by the MP3 format, but removes many of the components in MP3 which are inherited from layer 
I and layer II. I have also added some newer ideas that were utilized by AAC and PAC. Some of the more 
sophisticated ideas such as temporal noise shaping and predictive coding are not included.
</p>

<P>The problem with all of this: many of these fundamental ideas are patented in countries which allow 
patents on algorithms. There is still a difference between ideas and algorithms, so it may be possible
to implement this codec using different algorithms for the same ideas. It will require a significant 
amount of legal work to make this determination. If your beliefs do not coincide with the patent 
holder's beliefs, you could be sued and the courts will decide. If you dont have the money for such a 
law suit, then that is the end of the project!
</p>

<P>Just a cursiory patent search will yield dozens of patents on every aspect of audio compression.
Below I have referenced some of these patents along with my uninformed interpretation of what they 
claim.
</p>

<H3>Frame/Window types</H3>

<UL>
	<LI>1024 and 128 (for pre-echo) sample windows. MP3 uses 576 &amp; 192 sample windows. AAC uses 
	1024 and 128 sample windows. (Brandenburg &amp; Stoll 1994, Bosi et al. 1997 in <A HREF="refs.html">
	References</A>)</LI>
	<LI>Spectral coefficients computed from overlapping MDCT coefficients (lossless). MP3 and AAC apply 
	the MDCT only after first splitting the signal into frequency bands with windowed filterbanks.</LI>
	<LI>Pre-echo detection from the <A HREF="gpsycho/gpsycho.html">GPSYCHO</A> algorithm. The GPSYCHO 
	pre-echo detection algorithm is truely original, although it is such a simple concept that I'm sure 
	someone has patented it.</LI>
</UL>

<p>The very concept of using spectral transforms applied to frames of PCM samples seems to be patented
(US5579430). But I believe spectral transforms (or filterbanks) must be used because psycho acoustic
information is given in terms of spectral coefficients (the frequency domain). The majority of audio 
compression comes from allocating bits between different frequency bands based on psycho acoustic 
information.
</p>

<P>The concept of window switching to reduce pre-echo effects is patented in US5285498.
</p>


<H3>Critical Bands</H3>

<UL>
	<LI>Group coefficients in critical bands. MP3 uses 21 for long windows, 12 for short. AAC uses 
	49 for long windows, 14 for short.</LI>
	<LI>Allow option of <A HREF="gpsycho/ms_stereo.html">mid/side encoding</A> for each critical band.
	MP3 does not allow mid/side encoding on a band by band basis. AT&amp;T PAC does. (Johnston 
	&amp; Ferrera 1992 <A HREF="refs.html">References)</A></LI>
</UL>

<p>Critical bands are a way to group frequency bands which better mimics the response of the human ear.
The concept is old, but there may be patents on the use of critical bands for audio compression. The 
concept of mid/side encoding is patented in US5481614.
</p>

<H3>Quantization of MDCT coefficients</H3>

<UL>
	<LI>Associated to each critical band is a scale factor. The larger the scale factor, the more bits 
	allocated to this critical bands.</LI>
	<LI>Truncate MDCT coefficients *scalefactor to integers. This is all that is meant by Quantization.</LI>
	<LI>Choose scale factors so quantization distortion in each critical band is less than the masking 
	computed by the psycho-acoustic model.</LI>
	<LI>If more compression is desired (with some distortion) choose scale factors with<A 
	HREF="gpsycho/outer_loop.html">GPSYCHO algorithm</A>. Compression can be controlled to produce a 
	given bitrate, or given quality.</LI>
</UL>

<p>The use of scale factors to control the allocation of bits between scale factor bands is patented.
Even worse, just the concept of allocating bits among critical bands based on any set of external 
requirements is patented (US5579430).
</p>

<H3>Lossless compression of quantized MDCT coefficients</H3>

<UL>
	<LI>Some type of lossless compression and encoding of quantized data. MP3 uses Huffman coding with 
	precomputed tables each assigned a unique code.</LI>
</UL>

<p>The type of Huffman coding used in MP3 is patented (US5579430). Are there other types of Huffman coding 
which we could use? Is the concept of precomputed tables patentable? Or are just the tables themselves 
patented? A version of the algorith in gzip, optimized for audio frames would probably be the best.<BR>
But just the very fact of using optimized encoding is claimed to be patented! (US5579430).
</p>

<H3>Psycho-acoustic model (output used during quantization step)</H3>

<UL>
	<LI>Masking given by a linear function expressed in critical bands</LI>
	<LI>Strength of masking given from tonality of signal</LI>
	<LI>Tonality estimated by a measure of the predictability of the signal.</LI>
	<LI>Johnson (1988) and Brandenburg &amp; Johnston (1990) <A HREF="refs.html">References</A></LI>
</UL>

<p>The algebraic formulas for these quantities are in the published literature. The tonality formula 
is patented in US5040217.
</p>

<HR>
<BR><br>
<i><a href="index.html">Back to LAME index page</a></i>
</BODY>
</HTML>
